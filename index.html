<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Field Maintenance Portal</title>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

  <!-- YOUR FULL CSS REMAINS SAME -->
  <!-- (CSS not modified for brevity â€” keep your original CSS exactly as you sent) -->
</head>

<body>

<!-- KEEP YOUR ENTIRE BODY STRUCTURE SAME -->
<!-- LOGIN SCREEN + DASHBOARD + TABS + TABLES ALL SAME -->

<script>
  const ADMIN_USERNAME = "porag.das";
  const ADMIN_PASSWORD = "gknayakg07";

  const GOOGLE_FORM_URL =
    "https://docs.google.com/forms/d/e/1FAIpQLSdrEm24HgilvW_FcRx_hMwIFS-1htDyqj_R30ov9T8ObCENSQ/viewform";

  const DATA_URL =
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vQNuAp9IwF1UnVU4INnUt0IaHcBVA5c7EFYKMBTVXjC0fC4Wbv2_20cJUSUQk3iQ7RQt_e8BwLjrp0Y/pub?gid=405039605&single=true&output=csv";

  const ACCESS_SHEET_URL =
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vSQEYtdLJy6g0hojsLh-dPPMc8UFOFFw7aOSM7YUcoO7i6eq_ZCbXSuCGD4A8D_hzh2jb4OuxAGdzaQ/pub?gid=0&single=true&output=csv";

  let currentUser = null;
  let currentRole = null;

  /* =========================
     LOGIN FUNCTION (UPDATED)
     ========================= */

  async function login() {
    let username = document.getElementById("loginUsername").value.trim();
    let password = document.getElementById("loginPassword").value.trim();
    let msgBox = document.getElementById("loginMsg");

    msgBox.innerText = "";

    if (!username || !password) {
      msgBox.innerText = "âŒ Enter Username and Password";
      return;
    }

    /* ===== ADMIN LOGIN ===== */
    if (
      username.toLowerCase() === ADMIN_USERNAME.toLowerCase() &&
      password === ADMIN_PASSWORD
    ) {
      currentUser = username;
      currentRole = "ADMIN";

      localStorage.setItem("logged_user", currentUser);
      localStorage.setItem("logged_role", currentRole);

      msgBox.innerText = "âœ… Login Success!";
      showApp();
      return;
    }

    /* ===== HARD-CODED EXECUTIVE USER ===== */
    if (
      username.toLowerCase() === "rhittik.bt@maintenance.in".toLowerCase() &&
      password === "Rhittik@123"
    ) {
      currentUser = "Rhittik.bt@maintenance.in";
      currentRole = "EXECUTIVE";

      localStorage.setItem("logged_user", currentUser);
      localStorage.setItem("logged_role", currentRole);

      msgBox.innerText = "âœ… Login Success!";
      showApp();
      return;
    }

    /* ===== GOOGLE SHEET USERS ===== */
    try {
      msgBox.innerText = "ðŸ” Checking access...";

      let response = await fetch(ACCESS_SHEET_URL + "&nocache=" + new Date().getTime());
      let csvText = await response.text();
      let lines = csvText.split("\n").filter(l => l.trim() !== "");

      let found = null;

      for (let i = 1; i < lines.length; i++) {
        let cols = lines[i].split(",");

        let u = cols[0]?.trim();
        let p = cols[1]?.trim();
        let r = cols[2]?.trim()?.toUpperCase();

        if (!u || !p || !r) continue;

        if (u.toLowerCase() === username.toLowerCase() && p === password) {
          found = { username: u, role: r };
          break;
        }
      }

      if (!found) {
        msgBox.innerText = "âŒ Invalid Username or Password";
        return;
      }

      currentUser = found.username;
      currentRole = found.role;

      localStorage.setItem("logged_user", currentUser);
      localStorage.setItem("logged_role", currentRole);

      msgBox.innerText = "âœ… Login Success!";
      showApp();

    } catch (err) {
      msgBox.innerText = "âŒ Cannot connect to Access Sheet";
    }
  }

  /* =========================
     EVERYTHING BELOW REMAINS
     EXACTLY SAME AS YOUR FILE
     ========================= */

</script>

</body>
</html>
